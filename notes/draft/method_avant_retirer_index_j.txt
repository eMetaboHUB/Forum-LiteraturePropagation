\section{Materials and Methods}

\subsection{Data}

\subsubsection{The metabolic network}

Human-GEM [Robinson et al.] is a genome-scale reconstruction of the human metabolic network containing 13082 reactions and 8378 metabolites and is currently its most comprehensive representation. Even if metabolic networks are primarily designed for modelisation purposes (eg. Flux analysis), they also hold valuable topological information on the human metabolism. In the aim to use this network as a support to propagate literature, items dedicated to modelisation (biomass function, transport reactions, cellular compartments, etc ...) are not useful. A critical aspect is also the presence of side compounds, cofactors of reactions, [cite frainay et al. Computational methods to identify metabolic sub-networks] (eg. ATP, NAD, NADP, CoA, etc ...)  that could create spurious shorcurts between compounds actually very distant metabolically. In particular, this could highly disturbs the method used to propagate the neighborhood's literature, and to overcome this, we choose to build a Carbon skeleton graph. Built with the GSAM tool (https://forgemia.inra.fr/metexplore/gsam), we used the SBML of the metabolic network and the available SMILES annotations of metabolites, providing the description of their chemical structure. Based on an atom mapping procedure achieved with the RDT library [Cite], the rebuilt network is a compound graph, connecting two compounds when they are involved in at least one reaction, each on one side, by sharing at least one carbon. Atom mapping with the RDT library was previously applied on Recon3D [cite]. 

An illustrated example of this procedure is presented in Figure \ref{CarbonskeletonGraph}. In the raw metabolic network, the galactokinase reaction connects each of its substrates (Galactose, ATP) to each of its products (Galactose-1-phosphate, ADP, H+). However, while a link between Galactose and Galactose-1-phosphate or between ATP and ADP appears clearly, a direct connection between Galactose and ATP is more spurious, because ATP acts as a cofactor in this reaction. In this way, it seems reasonable that the Galactose-1-phosphate could receive and use as a prior knowledge the literature from Galactose, as the one is structurally derived from the other, but not from ATP. After reconstruction of the carbon skeleton graph, metabolites duplicated in several cellular compartments have also been merged in one super-compartment. Only the largest component with 2742 species and 10480 edges is conserved for the subsequent analysis. Even if the underlying chemical reaction is directed, the carbon skeleton graph is treated as undirected to use the links substrates-products or products-substrates equivalently in the propagation process. The transition matrix $P$ is built according to the weight policy defined in [MetaboRank]. Briefly, it allows to determine transition probabilities between compounds while accounting for the reaction level, which would otherwise be omitted by simply using the compound graph.




\begin{figure}[H]
\centering
  \includegraphics[scale=0.62]{Figures/CarbonSkelletonGraph.png}  
  \caption{Reconstruction of the carbon skeleton graph: an example of the Galactokinase reaction. The galactokinase is an enzyme that catalyzes the phosphorylation of galactose into galactose-1-phosphate. Colored circles describe the carbons shared between each participants of the reaction, their number is also indicated. The blue square shows the phosphate transferred from the ATP to the galactose. There is no carbon shared between Galactose and ADP or between ATP and Galactose-1-phosphate. }
\label{CarbonskeletonGraph}
\end{figure}

\subsubsection{Co-mentions in the literature}

The FORUM Knowledge Graph [Ref] provides links between PubChem compounds and scientific articles, themselves annotated with a descriptive set of MeSH descriptors. Since the December 2021 release, the FORUM KG also integrated the Human-GEM metabolic network v1.7 (see \url{https://github.com/SysBioChalmers/Human-GEM/releases/tag/v1.7.0}), converted in RDF format using an homemade tool (\url{https://services.pfem.clermont.inrae.fr/gitlab/forum/sbml2rdf}). The total number of articles associated with each metabolic species in the network as well as their co-mentions with MeSH descriptors associated with diseases, were then determined using SPARQL requests.



% ,compartments was avoided by merging al

\subsubsection{Counts and probabilities}

The approach is metabolite-centric, considering the total literature available for each metabolite and their co-mentions with disease-related MeSH descriptors as input data. 
Note that each article frequently discusses numerous metabolites and therefore the literature related to each metabolite, in terms of publications, is not exclusive to that chemical, but can be shared with others. We thus called a 'mention' the fact that an article discusses a metabolite.

We note $n_i$, the total number of mentions of a metabolite (not restricted to the medical literature) and then define $N = \sum_i n_i$ as the total number of mentions in the network. We also define $c_{i,j}$ as the number of articles co-mentioning the metabolite $i$ and the disease MeSH $j$ and $m_j = \sum_i c_{i,j}$ is the total number of mentions involving the MeSH $j$.

The aim of the method is to estimate the posterior distribution of the parameter $p_j$, representing the probability that a mention discussing a compound $k$, also discusses the disease $j$. To asses for the strength of their relation, $p_j$ is then compared to the overall probability $P_j = \frac{m_j}{N}$ that any mentions discuss the disease $j$. In order to determine the posterior distribution of $p_j$, especially useful for understudied compounds, we chose to estimate a prior distribution. Each step of the method will be described by relying on the Figure \ref{FigureMeth}. In Figure \ref{FigureMeth}.A, we introduce an exemple in which we study the relation between a target metabolite A and a MeSH descriptor, using a prior built from the literature of its neighbourhood (metabolites B, C, D, E, F, ...) and its observed literature. 

\begin{figure}[H]
\begin{center}
  \includegraphics[scale=0.175]{Figures/FigureMeth.png}  
  \caption{A step by step description of the proposed method.}
\label{FigureMeth}
\end{center}
\end{figure}

\subsubsection{Estimating the prior distribution}

Based on the assumption that the literature from the metabolic neighbourhood of a compound provides a useful prior on its own literature, the first step is to propagate the neighbors' literature. A random walks with restart (RWR) algorithm (or Personalized PageRank) is used to model a mention, sent by a metabolite $i$, which moves randomly through the edges in the network and reach other compounds $k$. The result is a probability vector $\pi_{i.}$, indicating the probabilties that a mention sent by the metabolite $i$, reach any metabolites $k$ in the network, noted $\pi_{i, k}$. The expected number of mentions sent by $i$ that reach the compound $k$ is then $\pi_{i, k} n_i$. However in this model, a compound can received its own mentions ($\pi_{k, k} > 0$) although only those derived from the neighborhood should be used to build the prior, as the metabolite should not influence its own prior knowledge.

A second bias is relative to the set of neighbors for which a metabolite is \textit{allowed} to contribute to their prior. Metabolites with very large corpora (Glucose, Tryptophan, etc ...) can propagate their literature to metabolites far distant metabolically, even if their probability to reach them $\pi_{i, k}$ is low. In case of metabolites with a direct neighborhood poorly discussed, they can predominantly contribute to the prior, although they are not metabolically relevant. This bias is accentuated by the highly skewed distribution of the literature. To contribute to the prior of $k$, a metabolite $i$ should have a probability of reaching $k$ (without considering the walks that land on itself) greater than the probability of choosing $k$ randomly.

The set of metabolites to which a metabolite $i$ is allowed to contribute, the influence neighbourhood of $i$, noted $C_i$, is therefore defined as : $$k \in C_i \quad \forall k \ne i, \frac{\pi_{i, k}}{(1 - \pi_{i, i})} > \frac{1}{(n - 1)}$$ 

These both aspects are illustrated in the Figure \ref{FigureMeth}.B: \textit{B} propagate its literature to its neighborhood, but no mentions are returning to \textit{B}, and, \textit{B} is not allowed to send mentions to \textit{Z}, being to far. According to these probabilties, the quantity of literature sent by $i$ that reach $k$ is noted $t_{i, k}$ such as:

\begin{equation*}
    t_{i, k} =
    \begin{cases}
      \frac{\pi_{i, k}}{\sum_{k' \in C_i} \pi_{i, k'}} \, n_i, & \text{if}\ k \in C_i.\\
      0, & \text{otherwise.}
    \end{cases}
\end{equation*}

% The prior is then constructed from the set of literature, derived from the neighbourhood, that has reached the metabolite $k$. 
Simetrically, we defined $T_k$ as the set of contributors of $k$, such as $t_{i, k} > 0$ . Each contributor $i$, has a weight $w_{i, k}$ in the prior of $k$, representing the proportion of literature reaching $k$, that was sent by $i$ (Cf. Figure \ref{FigureMeth}.C):

$$w_{i, k} = \frac{t_{i, k}}{\sum_{i' \in T_k} t_{i', k}}$$

Each contributor also has an individual probability to discuss the MeSH $j$. However, as for the compound of interest, the contributor $i$ may also be poorly described in the literature, providing an imprecise estimator of that probabilty. A preliminary bayesian shrinkage is therefore used to refine these estimators, with a first prior estimated from the overall frequency of the MeSH in the literature. Indeed, as there is no prior evidence of a relation between a compound and a MeSH in the literature, the both concept are apriori considered independent and therefore we expect that $p_j$ is on average $P_j$.

% Indeed, to prevent smoothing the contributions that could all be influenced by one overstudied compound, we do not use again their own neighborhood literature to build a prior.

This initial prior distribution on $p_j$ is the same for all the contributors, noted $f^{(0)}(p_j)$, and is therefore defined with a $Beta$ distribution, parametrize by mean and variance: 
$$Beta(\alpha^{(0)}_j, \beta^{(0)}_j) \text{ with } \alpha^{(0)}_j = \mu_j\nu \text{ and } \beta^{(0)}_j = (1 - \mu_j)\nu$$

$\mu_j = P_j$, the overall probability that a mention discuss the MeSH $j$, and $\nu$, a theorical sample size, is related to the variance of the distribution: $V(X) = \frac{\mu_j(1 - \mu_j)}{(1 + \nu)}$. The larger the attributed theoretical sample size, the smaller the variance, implying a higher level of confidence around the mean of this prior. $\nu$ is an hyperparameter, fixed at 1000 in this analysis (See details in Supplementary materials).

The posterior probability distribution that the contributor $i$ discuss the MeSH $j$, noted $f^{(1)}_i(p_j)$, is then define by : $$Beta(\alpha^{(1)}_{i,j}, \beta^{(1)}_{i,j} ) \text{ with } \alpha^{(1)}_{i,j} = \alpha^{(0)}_j + c_{i, j} \text{ and } \beta^{(1)}_{i,j} = \beta^{(0)}_j + (n_i - c_{i, j})$$

This procedure is illustrated in Figure \ref{FigureMeth}.D in which the contributor \textit{F} has only 2 publications annoted, with one discussing the MeSH of interest. The expected probability that F discusses this MeSH is therefore $\frac{1}{2}$, which clearly seems overestimated due to the low sample size. A shrinkage procedure is used to produce a better estimate of that probability by using a prior built from the overall frequency of the MeSH. In this example we fixed $\mu = \frac{1}{100}$ and $\nu = 100$. The mean of the obtained posterior distibution is approximately $0.02$, which seems more realistic.


As illustrated in Figure \ref{FigureMeth}.E, the prior distribution on $p_j$ for the compound $k$ is then defined as a mixture of the posterior distributions of its contributors $f^{(1)}_i(p_j)$ weighted by $w_{i, k}$: 
$$M_k^{(0)}(p_j) = \sum_{i \in T_k} w_{i, k} f^{(1)}_i(p_j)$$

\subsubsection{The final posterioir distribution}

For the compound $k$, the final posterior distribution of $p_j$ is thus expressed as a mixture of the updated posterior distributions of each contributors, reweighted according to the observed data ($n_k$ and $c_{k, j}$):
$$M_k^{(1)}(p_j) = \sum_{i \in T_k} W_{i, k} f^{(2)}_i(p_j)$$

$$
W_{i, k} = \frac
{
w_{i, k} C_{i, j}}
{
\sum_{i' \in T_k} w_{i',k} C_{i', j}
} 
\text{ with }
C_{i, j} = \binom{n_k}{c_{k, j}} \frac{B(\alpha^{(2)}_{i,j}, \beta^{(2)}_{i,j})}{B(\alpha^{(1)}_{i,j}, \beta^{(1)}_{i,j})}
\text{ , }
\alpha^{(2)}_{i,j} = \alpha^{(1)}_{i, j} + c_{k, j}
\text{ and }
\beta^{(2)}_{i,j} = \beta^{(1)}_{i, j} + (n_k - c_{k, j})
$$

% B(\alpha^{(2)}_{i,j}, \beta^{(2)}_{i,j}) / B(\alpha^{(1)}_{i,j}, \beta^{(1)}_{i,j})
% B(\alpha^{(2)}_{i',j}, \beta^{(2)}_{i',j}) / B(\alpha^{(1)}_{i',j}, \beta^{(1)}_{i',j})

$$f^{(2)}_i(p_j) \text{ representing the } Beta(\alpha^{(2)}_{i,j}, \beta^{(2)}_{i,j})$$

$$$$
To get a better intuition on the final weights $W_{i, k}$, we could note that $\frac{W_{i, k}}{w_{i, k}}$, the ratio of weights between the prior and posterior mix, is equivalent to the ratio between the probability of observing the compound $k$'s data in the $i^{th}$ component of the prior mix ($C_{i, j}$), versus, the weighted average of observing it in all the components. Consequently, the change in the contributor $i$'s weight is related to the likelihood of observing the data according to its literature. Finally, to evaluate the strength of the relation between the metabolite $k$ and the MeSH $j$, we estimate two indicators: 
\begin{itemize}
    \item the Log2 fold change between the mean of the posterioir distribution and the overall frequency of $j$ in the literature, noted $Log_2FC$.
     \item the probability that $p_j$ will take a value lower than $P_j$ according to the posterior mix, noted $CDF$.
\end{itemize}

 

% A random walks with restart (RWR) algorithm (or Personalized PageRank) is used to model the process by which an article sent by a metabolite could reach another metabolite in the network.

% Knowing the total number of articles associated to a compound $n_i$, the expecter number of 



% To obtain a global matrix $\Pi$ containing the probabilities $\pi_{i}$ in column, a RWR procedure is applied from each metabolite $i$ in the network, with the matrix $P$ and the damping parameter $\alpha$.


% The probability distribution that the contributor $i$ discuss the MeSH $j$, is then define by the posterior distribution: $$Beta(\mu_j\nu + m_i^j, (1 - \mu_j)\nu + (n_i - m_i^j))$$

% For sake of clarity, we noted it: $P(p_j | \alpha_i^j, \beta_i^j)$ with $\alpha_i^j = \mu_j\nu + m_i^j$ and $\beta_i^j = (1 - \mu_j)\nu + (n_i - m_i^j)$

% The prior on $p_j$ for the compound $k$ can then be defined as a mixture distribution of the probability distribution $P(p_j | \alpha_i^j, \beta_i^j)$ weighted by $w^{(i)}_k$:  $$f(p_j | \bm{w_k}, \bm{\alpha^j}, \bm{\beta^j}) = \sum_{i \in T_k} w^{(i)}_k P(p_j | \alpha_i^j, \beta_i^j)$$

% With this prior, the posterior distribution of $p_j$ for the compound is: $$F(p_j | m_k^j, n_k) = \sum_{i \in T_k} W^{(i)}_k P(p_j | \alpha_i^j, \beta_i^j, m_k^j, n_k)$$

